{% extends 'base.html' %}
{% block title %}Crear ProducciÃ³n{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-6">ğŸ§¾ Crear Nueva ProducciÃ³n</h1>

<form method="post" class="bg-white p-6 rounded-2xl shadow-md space-y-4">
  {% csrf_token %}

  <div>
    <label class="block font-semibold mb-2">Cantidad de Repollas:</label>
    <input type="number" id="repollas" name="repollas" min="1" required class="border rounded-lg p-2 w-full">
  </div>

  <div>
    <label class="block font-semibold mb-2">Cajas (calculadas automÃ¡ticamente):</label>
    <input type="number" id="boxes" name="boxes" readonly class="border rounded-lg p-2 w-full bg-gray-100">
  </div>

  <div>
    <label class="block font-semibold mb-2">Ventas ($):</label>
    <input type="number" name="sales" min="0" step="0.01" value="0" class="border rounded-lg p-2 w-full">
  </div>

  <div class="flex justify-between items-center mb-4">
    <h2 class="text-lg font-semibold">Ingredientes Usados</h2>
    <button type="button" id="addRow" class="bg-blue-600 text-white px-3 py-1 rounded-lg hover:bg-blue-700">
      â• Agregar Ingrediente
    </button>
  </div>

  <table class="w-full border-collapse border border-gray-200" id="ingredientTable">
    <thead class="bg-gray-100">
      <tr>
        <th class="border p-2">Ingrediente</th>
        <th class="border p-2">Cantidad</th>
        <th class="border p-2">Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="p-2">
          <select name="ingredient_id[]" class="border rounded-lg p-2 w-full" required>
            <option value="">-- Selecciona Ingrediente --</option>
            {% for ingredient in ingredients %}
              <option value="{{ ingredient.id }}">{{ ingredient.name }} (Stock: {{ ingredient.stock }})</option>
            {% endfor %}
          </select>
        </td>
        <td class="p-2">
          <input type="number" name="quantity[]" min="1" value="1" class="border rounded-lg p-2 w-full" required>
        </td>
        <td class="p-2 text-center">
          <button type="button" class="removeRow bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">ğŸ—‘ï¸</button>
        </td>
      </tr>
    </tbody>
  </table>

  <div class="flex justify-end mt-4">
    <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
      ğŸ’¾ Guardar ProducciÃ³n
    </button>
  </div>
</form>

<script>
  // Calcular cajas automÃ¡ticamente
  const repollasInput = document.getElementById('repollas');
  const boxesInput = document.getElementById('boxes');

  repollasInput.addEventListener('input', () => {
    const repollas = parseInt(repollasInput.value) || 0;
    boxesInput.value = Math.floor(repollas / 6);
  });

  // Agregar fila de ingrediente
  document.getElementById('addRow').addEventListener('click', () => {
    const table = document.querySelector('#ingredientTable tbody');
    const newRow = table.rows[0].cloneNode(true);

    // Limpiar valores
    newRow.querySelectorAll('input').forEach(input => input.value = '');
    newRow.querySelector('select').selectedIndex = 0;

    table.appendChild(newRow);
  });

  // Eliminar fila
  document.addEventListener('click', (e) => {
    if (e.target.classList.contains('removeRow')) {
      const row = e.target.closest('tr');
      const table = document.querySelector('#ingredientTable tbody');
      if (table.rows.length > 1) {
        row.remove();
      }
    }
  });
</script>
{% endblock %}
